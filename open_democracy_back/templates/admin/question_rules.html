{% extends "wagtailadmin/base.html" %}

{% block content %}
    {% include "wagtailadmin/shared/header.html" with title="Modal Title" icon="no-view" %}

    <div class="nice-padding">
        <h1>Conditions d'affichage pour la question : <i>{{ data.question }}</i></h1>

        {% if data.rules.count > 1 %}
            {% include "admin/components/intersection_operator.html" with url="question-intersection-operator" id=data.question.id rules_intersection_operator=data.rules_intersection_operator %}
        {% endif %}

        {% if data.rules.count > 0 %}
            <h2>Conditions d'affichage déjà existantes</h2>
            {% include "admin/components/existing_rules.html" with url="delete-question-filter" id=data.question.id rules=data.rules %}
        {% endif %}

        <h2>Créer une nouvelle condition d'affichage</h2>
        <form action="{% url 'question-filter' data.question.id %}" method="post">
            {% csrf_token %}
            {{ rule_form.question.as_hidden }}
            <div style="display: flex;">
                {% if not data.is_profiling_question %}
                <input id="toggle-conditional-question" class="toggle toggle-left" name="conditional_type" value="question" type="radio" checked>
                <label for="toggle-conditional-question" class="btn">Question</label>
                <input id="toggle-conditional-profile-type" class="toggle toggle-right" name="conditional_type" value="profile" type="radio">
                <label for="toggle-conditional-profile-type" class="btn">Profil</label>
                {% endif %}
            </div>

            <div id="id_display_conditional_question" style="display: block;">
                {% include "admin/components/condition_question.html" with rule_form=rule_form %}
            </div>
            <div id="id_display_conditional_profile_type" style="display: none;">
                <div>
                    {{ rule_form.conditional_profile_type.error }}
                    {{ rule_form.conditional_profile_type.label_tag }}
                    {{ rule_form.conditional_profile_type }}
                </div>
            </div>
            <br/>
            <div class="actions">
                <input type="submit" class="button button-small button-secondary" value="Ajouter">
            </div>
        </form>

        <a type="button" class="button button-small button-secondary" style="margin-top: 1rem;"
            href="{% if data.question %} /admin/snippets/open_democracy_back/questionnairequestion/ {% elif data.profile_type %} /admin/snippets/open_democracy_back/profilingquestion/ {% endif %}"
            >Terminer</a>
    </div>

    <script type="text/javascript">
        var display_conditional_question = document.getElementById("id_display_conditional_question");
        var display_conditional_profile_type = document.getElementById("id_display_conditional_profile_type");

        document.getElementById("toggle-conditional-question").addEventListener("click", function() {
            display_conditional_question.style.display = "block";
            display_conditional_profile_type.style.display = "none";
        })

        if(document.getElementById("toggle-conditional-profile-type")) {
            document.getElementById("toggle-conditional-profile-type").addEventListener("click", function() {
                display_conditional_question.style.display = "none";
                display_conditional_profile_type.style.display = "block";
            })
        }

    </script>

{% endblock %}

{% block extra_css %}
    {{ block.super }}
    <style>
        .delete-buttons{
            display: flex;
            flex-direction: row;
            justify-content: space-between;
        }

        .btn {
            border: 2px solid var(--color-primary);
            display: inline-block;
            padding: 8px;
            position: relative;
            text-align: center;
            transition: background 600ms ease, color 600ms ease;
       }
        input[type="radio"].toggle {
            display: none;
       }
        input[type="radio"].toggle + label {
            cursor: pointer;
            min-width: 50px;
            color: var(--color-primary);
       }
        input[type="radio"].toggle.toggle-left + label {
            border-right: 0;
       }
        input[type="radio"].toggle.toggle-right + label {
            margin-left: -5px;
       }
        input[type="radio"].toggle:checked + label {
            cursor: default;
            color: #fff;
            background-color: var(--color-primary);
            transition: color 200ms;
       }

    </style>
{% endblock %}
