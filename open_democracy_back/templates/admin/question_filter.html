{% extends "wagtailadmin/base.html" %}

{% block extra_css %}
    {{ block.super }}
    <style>
        .vertical {
            display: flex;
            flex-direction: column;
        }
    </style>
{% endblock %}

{% block content %}
    {% include "wagtailadmin/shared/header.html" with title="Modal Title" icon="no-view" %}

    <div class="nice-padding">
        conditionals_questions : {{ conditionals_questions }}
        <form action="{% url 'filter' %}" method="post">
            {% csrf_token %}
            {{ filter_form.question.as_hidden }}
            {% if conditionals_questions.count > 0 %}
                <div>
                    {{ filter_form.intersection_operator.error }}
                    {{ filter_form.intersection_operator.label_tag }}
                    {{ filter_form.intersection_operator }}
                </div>
            {% endif %}

            <div>
                {{ filter_form.conditional_question.error }}
                {{ filter_form.conditional_question.label_tag }}
                {{ filter_form.conditional_question }}
            </div>

            <div id="id_display_response_choices" style="display: none;">
                {{ filter_form.response_choices.error }}
                {{ filter_form.response_choices.label_tag }}
                {{ filter_form.response_choices }}
            </div>
            <div id="id_display_scale_response" style="display: none;">
            </div>
            <div id="id_display_numerical_response" style="display: none;">
                {{ filter_form.numerical_operator.error }}
                {{ filter_form.numerical_operator.label_tag }}
                {{ filter_form.numerical_operator }}
                {{ filter_form.numerical_value.error }}
                {{ filter_form.numerical_value.label_tag }}
                {{ filter_form.numerical_value }}
            </div>
            <div id="id_display_boolean_response" style="display: none;">
                {{ filter_form.boolean_response.error }}
                {{ filter_form.boolean_response.label_tag }}
                {{ filter_form.boolean_response }}
            </div>
            <br/>
            <input type="submit" value="Ajouter">
        </form>
    </div>

    <script type="text/javascript">
        const QUESTIONS_RESPONSE_BY_ID = JSON.parse("{{questions_response_by_id | escapejs }}");
        console.log(QUESTIONS_RESPONSE_BY_ID)

        var new_question_filter = document.getElementById("id_conditional_question");
        var display_response_choices = document.getElementById("id_display_response_choices");
        var display_scale_response = document.getElementById("id_display_scale_response");
        var display_numerical_response = document.getElementById("id_display_numerical_response");
        var display_boolean_response = document.getElementById("id_display_boolean_response");

        new_question_filter.addEventListener("change", function() {
            const new_question_filter_type = QUESTIONS_RESPONSE_BY_ID[new_question_filter.value].type
            if (new_question_filter_type == "unique_choice" || new_question_filter_type == "multiple_choice"){
                var str = ""
                for (const [response_choice_id, response_choice] of Object.entries(QUESTIONS_RESPONSE_BY_ID[new_question_filter.value].responses)) {
                    var id = "id_response_choices_" + response_choice_id
                    str += "<li><label for='" + id + "'>"
                        + "<input type='checkbox' name='response_choices' value='" + response_choice_id + "' id='" + id + "'></input>"
                        + response_choice
                        + "</label></li>"
                }
                document.getElementById("id_response_choices").innerHTML = str;
                display_response_choices.style.display =  "block";
            } else {
                display_response_choices.style.display =  "none";
            }

            if (new_question_filter_type == "numerical" || new_question_filter_type == "closed_with_scale") {
                display_numerical_response.style.display =  "block";
            } else {
                display_numerical_response.style.display =  "none";
            }

            if (new_question_filter_type == "closed_with_scale") {
                display_scale_response.innerHTML = "La r√©ponse est contenu entre "
                    + QUESTIONS_RESPONSE_BY_ID[new_question_filter.value].min
                    + " et "
                    + QUESTIONS_RESPONSE_BY_ID[new_question_filter.value].max
                display_scale_response.style.display =  "block";
            } else {
                display_scale_response.style.display =  "none";
            }

            if (new_question_filter_type == "boolean") {
                display_boolean_response.style.display =  "block";
            } else {
                display_boolean_response.style.display =  "none";
            }
        });
    </script>

{% endblock %}
